pragma solidity ^0.8.10;

import "hardhat/console.sol";
import "@openzeppelin/contracts/utils/Counters.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";
import {Base64} from "./libraries/Base64.sol";

contract Domain is ERC721URIStorage {

    mapping(string => address) public domains;

    mapping(string => uint) private domainCount;

    string pre_svg = '<svg xmlns="http://www.w3.org/2000/svg" width="270" height="270" fill="none"> <path fill="url(#B)" d="M0 0h270v270H0z"/> <defs> <filter id="A" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse" height="270" width="270"> <feDropShadow dx="0" dy="1" stdDeviation="2" flood-opacity=".225" width="200%" height="200%"/> </filter> </defs> <g transform="scale(0.3 0.3)translate(-100 30)"> <path d="M367.056,210.091C367.396,209.801 367.876,209.178 367.774,207.949C367.709,207.164 367.167,206.535 366.46,206.328C365.867,205.156 364.915,203.244 364.755,202.763C363.215,198.145 359.379,194.856 354.865,193.051C353.6,192.545 352.527,192.633 351.498,192.916C351.073,193.032 350.66,193.188 350.235,193.319C349.899,193.423 349.553,193.527 349.151,193.447C345.478,192.712 340.926,192.737 337.011,194.055C332.813,195.469 329.343,198.327 328.138,203.146C326.871,208.216 327.732,212.61 330.053,215.945C332.357,219.256 336.139,221.552 340.896,222.345C342.302,222.579 343.919,223.195 345.525,223.514C346.879,223.783 348.226,223.855 349.481,223.541C353.744,222.476 355.645,220.949 359.123,218.63C360.699,217.58 363.055,216.355 364.698,214.798C366.104,213.465 367.019,211.891 367.056,210.091ZM363.679,208.993C362.818,207.606 361.544,204.713 361.287,203.943C360.092,200.355 357.025,197.89 353.518,196.488C352.744,196.178 352.161,196.576 351.535,196.781C350.58,197.093 349.592,197.303 348.441,197.073C345.333,196.451 341.48,196.447 338.167,197.562C335.136,198.583 332.555,200.571 331.685,204.051C330.719,207.915 331.277,211.278 333.046,213.819C334.831,216.384 337.806,218.083 341.491,218.697C342.718,218.902 344.102,219.375 345.502,219.723C346.557,219.985 347.623,220.198 348.602,219.953C352.376,219.01 354.029,217.598 357.108,215.545C358.328,214.732 360.064,213.825 361.49,212.706C362.478,211.931 363.399,211.11 363.399,209.975C363.399,209.614 363.502,209.277 363.679,208.993Z" stroke="black" stroke-width="5"/> <path d="M451.14,185.308C449.784,185.189 448.535,185.354 447.77,185.928C446.696,186.733 445.807,187.995 445.059,189.437C444.163,191.164 443.463,193.168 442.636,194.547C441.499,196.443 439.165,200.313 438.728,202.497C438.181,205.236 438.381,208.913 439.721,211.785C440.719,213.924 442.323,215.628 444.608,216.39C445.418,216.66 446.284,216.674 447.168,216.6C447.841,216.544 448.534,216.345 449.168,216.599C451.187,217.406 452.766,217.483 454.328,217.354C455.595,217.249 456.846,216.974 458.425,216.974C468.927,216.974 476.031,215.375 484.988,210.896C491.873,207.453 495.804,198.401 489.878,192.475C485.813,188.41 478.018,185.562 472.353,184.146C471.438,183.917 470.519,183.958 469.596,184.099C468.755,184.227 467.914,184.504 467.061,184.362C466.286,184.233 465.629,183.914 464.949,183.687C463.899,183.335 462.817,183.129 461.503,183.391C460.361,183.62 459.18,183.514 458.01,183.442C456.496,183.35 454.996,183.299 453.571,183.656C452.812,183.845 451.968,184.511 451.14,185.308ZM448.683,190.431C448.4,190.915 448.143,191.448 447.89,191.987C447.146,193.572 446.496,195.245 445.765,196.463C444.789,198.089 442.689,201.356 442.315,203.229C441.969,204.958 442.007,207.18 442.616,209.132C443.141,210.813 444.086,212.324 445.754,212.88C446.408,213.098 447.133,212.88 447.851,212.831C448.762,212.769 449.662,212.821 450.515,213.162C452.197,213.835 453.443,213.752 454.752,213.595C455.874,213.46 457.035,213.277 458.425,213.277C468.284,213.277 474.956,211.788 483.365,207.583C488.095,205.218 491.375,199.172 487.305,195.102C483.646,191.444 476.572,189.009 471.475,187.734C470.7,187.54 469.924,187.794 469.138,187.925C468.252,188.074 467.361,188.158 466.466,188.009C465.649,187.873 464.926,187.602 464.212,187.342C463.593,187.116 462.99,186.862 462.214,187.017C460.766,187.307 459.271,187.223 457.788,187.132C457.244,187.099 456.702,187.062 456.167,187.062C456.125,187.326 456.026,187.585 455.865,187.819C455.225,188.754 453.997,189.2 452.486,189.143C452.265,189.348 452.043,189.538 451.82,189.701C450.94,190.347 450.01,190.641 449.093,190.515C448.958,190.496 448.821,190.469 448.683,190.431Z" stroke="black" stroke-width="5"/> <path d="M276.638,311.814C276.628,311.893 276.622,311.974 276.622,312.056C276.622,318.292 272.535,321.015 268.285,324.004C264.498,326.666 260.536,329.474 258.113,334.113C255.686,338.759 254.732,345.28 257.278,355.465C260.956,370.176 269.81,376.183 280.8,378.519C291.255,380.741 303.749,379.494 315.404,379.494C336.273,379.494 357.918,375.592 378.545,377.179C411.156,379.688 445.454,381.486 477.695,386.86C499.678,390.524 520.856,397.799 542.845,401.182C553.758,402.861 565.277,400.005 576.257,400.737C584.8,401.307 595.137,401.508 604.122,399.237C613.54,396.857 621.477,391.786 624.762,381.931C625.662,379.232 625.651,375.709 625.254,371.975C624.714,366.886 623.472,361.371 623.472,357.322C623.472,333.502 616.627,309.389 610.945,286.661C610.215,283.739 608.57,281.028 606.801,278.365C605.224,275.992 603.546,273.659 602.554,271.178C598.516,261.084 594.2,251.55 591.546,240.933C587.926,226.454 592.777,220.058 598.048,214.003C601.964,209.504 606.033,205.137 607.712,198.419C609.07,192.988 607.524,187.658 605.935,182.537C604.569,178.13 603.109,173.91 604.439,169.919C610.869,150.627 617.812,133.958 624.301,114.491C629.17,99.883 626.693,79.988 619.164,62.5C611.606,44.946 598.971,29.878 583.879,24.847C573.39,21.35 565.131,26.207 557.649,33.061C550.797,39.339 544.647,47.333 537.69,50.812C525.998,56.658 524.3,63.18 517.999,73.681C514.157,80.084 506.309,87.141 500.724,92.726C495.125,98.325 481.564,112.846 475.978,117.036C467.133,123.67 434.833,133.295 423.511,136.126C416.605,137.852 407.552,136.995 400.393,136.995C365.786,136.995 358.315,127.361 330.268,108.663C316.7,99.618 301.062,93.816 287.238,85.522C272.762,76.836 260.783,73.27 245.768,68.265C244.694,67.907 239.877,66.23 236.461,65.871C235.398,65.759 234.448,65.776 233.715,65.933C232.929,66.1 232.323,66.434 231.899,66.859C225.42,73.337 223.786,80.402 223.803,87.869C223.818,94.862 225.351,102.219 225.351,109.744C225.351,133.041 229.669,159.973 242.754,179.599C257.782,202.142 278.671,222.827 290.214,245.914C293.86,253.206 292.498,259.95 289.764,266.493C286.807,273.571 282.289,280.434 279.951,287.447C278.679,291.263 278.317,295.46 278.027,299.603C277.758,303.448 277.555,307.242 276.572,310.57C276.446,310.997 276.48,311.433 276.638,311.814ZM280.151,311.373C280.235,311.584 280.281,311.815 280.281,312.056C280.281,319.742 275.613,323.355 270.374,327.038C267.045,329.378 263.479,331.76 261.348,335.839C259.221,339.91 258.594,345.633 260.825,354.56C264.736,370.202 275.296,374.677 287.765,375.811C296.54,376.608 306.236,375.798 315.404,375.798C336.364,375.798 358.105,371.9 378.823,373.493C411.539,376.01 445.946,377.822 478.29,383.213C500.258,386.874 521.422,394.147 543.396,397.528C554.208,399.191 565.619,396.324 576.497,397.049C584.694,397.595 594.614,397.83 603.234,395.651C611.421,393.582 618.439,389.318 621.295,380.751C622.052,378.48 621.951,375.512 621.617,372.37C621.061,367.145 619.814,361.479 619.814,357.322C619.814,333.804 613.008,310.006 607.398,287.566C606.767,285.042 605.293,282.726 603.764,280.426C602.043,277.836 600.245,275.271 599.162,272.563C595.061,262.311 590.694,252.621 587.999,241.838C583.929,225.561 589.375,218.369 595.301,211.562C598.848,207.486 602.644,203.6 604.165,197.514C605.353,192.763 603.834,188.121 602.444,183.642C600.833,178.449 599.404,173.442 600.972,168.739C607.402,149.447 614.344,132.778 620.833,113.311C625.456,99.444 622.956,80.575 615.809,63.974C608.69,47.44 596.948,33.096 582.732,28.357C573.644,25.328 566.59,29.86 560.107,35.799C552.996,42.314 546.532,50.515 539.313,54.125C528.412,59.575 527.002,65.807 521.128,75.598C517.152,82.224 509.077,89.573 503.298,95.353C497.615,101.036 483.829,115.752 478.159,120.004C469.087,126.808 436.003,136.81 424.389,139.714C417.221,141.506 407.825,140.692 400.393,140.692C364.826,140.692 357.078,130.965 328.253,111.748C314.733,102.735 299.145,96.965 285.37,88.7C271.149,80.168 259.372,76.692 244.622,71.776C243.636,71.447 239.219,69.877 236.082,69.548C235.439,69.48 234.562,69.563 234.377,69.582C228.799,75.214 227.446,81.375 227.461,87.86C227.477,94.856 229.01,102.216 229.01,109.744C229.01,132.343 233.095,158.495 245.788,177.534C260.901,200.204 281.871,221.031 293.479,244.247C297.675,252.638 296.28,260.401 293.134,267.93C290.212,274.924 285.728,281.697 283.418,288.627C282.243,292.152 281.945,296.036 281.676,299.864C281.394,303.892 281.145,307.863 280.151,311.373Z" stroke="black" stroke-width="5"/> <path d="M417.035,139.379C416.955,139.961 416.832,140.577 416.679,141.22C414.97,148.399 409.489,158.42 408.359,161.811C401.4,182.689 407.809,209.397 419.661,227.175C428.564,240.529 432.341,255.599 435.144,270.984C438.008,286.704 439.858,302.754 444.85,317.727C445.507,319.699 446.529,321.063 447.777,321.971C450.462,323.924 454.441,323.729 458.843,322.136C466.823,319.247 476.436,311.904 480.413,310.578C481.309,310.279 485.834,309.398 488.703,309.597C489.056,309.622 489.519,309.725 489.765,309.785C490.399,312.108 489.702,314.364 488.703,316.577C487.442,319.371 485.675,322.097 484.61,324.759C479.871,336.608 475.83,344.464 469.748,349.962C463.694,355.433 455.634,358.524 442.995,361.052C439.112,361.828 435.529,360.757 432.002,359.421C428.032,357.917 424.127,356.075 420.049,355.492C411.078,354.211 402.945,356.86 393.927,356.86C387.456,356.86 381.546,355.826 375.344,354.585C365.425,352.602 351.04,355.01 337.952,354.4C325.732,353.83 314.624,350.578 310.209,337.332C308.121,331.068 309.714,325.624 312.488,320.535C315.492,315.023 319.848,309.908 322.973,304.7C326.553,298.732 328.321,292.157 330.133,285.622C331.849,279.436 333.602,273.286 337.244,267.822C348.284,251.262 366.278,240.208 377.43,223.48C388.391,207.038 391.964,185.163 397.97,167.147C398.762,164.77 398.951,161.727 398.856,158.517C398.725,154.084 398.065,149.312 398.065,145.772C398.065,142.286 397.124,135.357 397.124,135.357C397.004,134.48 396.285,133.812 395.41,133.765C394.535,133.717 393.749,134.304 393.537,135.163L393.304,136.009C393.125,136.295 393.021,136.633 393.021,136.996C393.021,138.086 393.646,138.474 393.832,138.602L393.844,138.61C394.101,140.813 394.407,143.845 394.407,145.772C394.407,149.342 395.067,154.156 395.199,158.628C395.28,161.356 395.176,163.947 394.502,165.968C388.595,183.689 385.178,205.241 374.395,221.415C363.243,238.143 345.25,249.197 334.21,265.757C330.345,271.555 328.431,278.06 326.61,284.624C324.887,290.839 323.249,297.109 319.844,302.784C316.694,308.033 312.312,313.195 309.283,318.752C306.023,324.733 304.287,331.15 306.741,338.512C311.716,353.435 324.016,357.45 337.783,358.092C350.682,358.694 364.858,356.256 374.633,358.211C381.072,359.499 387.21,360.556 393.927,360.556C402.769,360.556 410.741,357.896 419.537,359.152C423.357,359.698 426.999,361.473 430.718,362.882C434.879,364.458 439.125,365.594 443.705,364.678C457.187,361.982 465.73,358.553 472.187,352.717C478.615,346.906 482.993,338.668 488.002,326.144C489.049,323.528 490.794,320.855 492.032,318.111C493.478,314.905 494.246,311.608 493.121,308.233C492.893,307.549 492.406,306.955 491.612,306.541C490.975,306.21 490.05,305.986 488.954,305.91C485.601,305.677 480.314,306.719 479.267,307.068C475.274,308.398 465.619,315.756 457.609,318.656C453.408,320.177 449.667,320.597 448.317,316.547C443.381,301.739 441.575,285.861 438.742,270.315C435.848,254.432 431.886,238.896 422.696,225.11C411.428,208.208 405.21,182.839 411.827,162.99C412.973,159.55 418.502,149.369 420.236,142.084C420.743,139.954 420.931,138.039 420.706,136.53C420.51,135.211 420.008,134.149 419.232,133.373C418.502,132.643 417.813,132.566 417.334,132.613C416.639,132.681 415.97,133.061 415.577,133.936C415.376,134.381 415.247,135.125 415.245,135.9C415.243,136.921 415.444,137.979 415.555,138.249C415.817,138.891 416.397,139.304 417.035,139.379ZM396.403,136.02L396.407,136.02L396.376,135.978L396.403,136.02Z" stroke="black" stroke-width="5"/> <path d="M376.198,269.26C375.529,268.958 374.716,269.081 374.164,269.633C371.634,272.163 366.416,273.739 361.322,275.864C355.555,278.269 349.971,281.318 347.489,286.28C345.824,289.612 345.192,293.469 344.816,297.454C344.47,301.137 344.339,304.932 343.634,308.457C342.925,312.002 343.017,317.353 344.64,321.549C345.845,324.662 347.881,327.137 350.859,328.13C354.258,329.263 361.236,329.112 368.806,328.144C379.978,326.716 392.439,323.576 396.32,320.989C402.335,316.979 404.221,309.595 406.284,303.408C407.602,299.453 406.95,294.822 405.144,290.392C402.555,284.042 397.629,278.129 393.548,275.409C390.018,273.056 385.642,271.902 382.267,270.214C381.632,269.897 380.246,269.264 379.515,268.934C379.168,268.445 378.591,268.137 377.952,268.165C376.852,268.212 376.397,268.792 376.198,269.26ZM377.064,271.818C376.98,271.977 376.871,272.127 376.737,272.26C373.959,275.039 368.313,276.947 362.718,279.28C357.797,281.333 352.872,283.713 350.755,287.947C349.287,290.882 348.789,294.294 348.459,297.804C348.1,301.616 347.949,305.542 347.22,309.189C346.624,312.171 346.682,316.674 348.048,320.203C348.837,322.241 350.055,323.97 352.005,324.62C355.1,325.652 361.453,325.358 368.347,324.477C378.87,323.132 390.65,320.34 394.305,317.904C399.613,314.365 400.996,307.689 402.817,302.228C403.874,299.056 403.21,295.353 401.761,291.8C399.468,286.175 395.148,280.904 391.533,278.494C388.132,276.226 383.897,275.154 380.644,273.527C379.913,273.162 378.639,272.64 377.824,272.243C377.525,272.097 377.268,271.95 377.064,271.818ZM378.238,271.847L378.215,271.85L378.222,271.849L378.238,271.847Z" stroke="black" stroke-width="5"/> <path d="M314.301,314.933C314.352,314.963 314.662,315.153 314.84,315.315C315.337,315.77 315.832,316.405 316.326,317.103C317.554,318.837 318.742,320.928 319.737,322.225C320.374,323.055 321.005,323.617 321.521,323.874C325.953,326.09 329.417,329.007 333.215,331.717C337.258,334.602 341.654,337.266 347.759,338.793C361.533,342.236 378.461,339.821 391.873,337.905C404.171,336.148 417.027,339.017 429.008,336.021C432.661,335.108 432.456,335.544 432.921,335.557C433.338,335.568 434.187,335.428 437.204,334.221C441.866,332.357 447.669,331.561 451.133,329.519C452.61,328.648 453.719,327.562 454.362,326.214C455.016,324.842 455.218,323.171 454.684,321.082C454.431,320.095 453.432,319.5 452.455,319.755C451.477,320.01 450.889,321.019 451.141,322.007C451.412,323.065 451.397,323.916 451.065,324.611C450.502,325.793 449.206,326.487 447.654,327.115C444.263,328.489 439.667,329.261 435.858,330.785C434.313,331.403 433.326,331.731 433.012,331.832C432.804,331.784 432.476,331.727 432.104,331.73C431.52,331.733 430.43,331.858 428.13,332.433C416.268,335.399 403.537,332.505 391.361,334.245C378.371,336.1 361.978,338.539 348.638,335.204C343.045,333.806 339.03,331.341 335.325,328.698C331.386,325.887 327.776,322.885 323.185,320.582C323.133,320.526 322.591,319.929 322.246,319.434C321.357,318.159 320.345,316.425 319.302,314.952C318.488,313.803 317.641,312.807 316.827,312.181C315.997,311.543 315.151,311.238 314.357,311.238C313.347,311.238 312.527,312.066 312.527,313.086C312.527,314.087 313.317,314.904 314.301,314.933Z" stroke="black" stroke-width="5"/> </g> <defs> <linearGradient id="B" x1="0" y1="0" x2="270" y2="270" gradientUnits="userSpaceOnUse"> <stop stop-color="#DC7D00"/><stop offset="1" stop-color="#111111" stop-opacity=".99"/> </linearGradient> </defs> <text x="32.5" y="231" font-size="27" fill="#fff" filter="url(#A)" font-family="Plus Jakarta Sans,DejaVu Sans,Noto Color Emoji,Apple Color Emoji,sans-serif" font-weight="bold">';
    string post_svg = '</text></svg>';

    string private tldomain = ".corgi";

    using Counters for Counters.Counter;

    Counters.Counter private _tokenIds;
    
    constructor() ERC721("DOMAIN_ENS", "ENS"){
        console.log("ens domain contract created");
    }

    function price(string memory _domain) public pure returns(uint){
        uint  _domain_length = bytes(_domain).length;
    
        if (_domain_length < 3) {
            return 0.5*10*18;
        } else if (_domain_length <6) {
            return 0.2*10*18;
        } else {
            return 0.1*10*18;
        }
    }



    function addDomain(string memory domain) payable public {
        require(domains[domain] == address(0), "domain already registered");

        uint domain_price = price(domain);

        require(msg.value > domain_price, "domain price is higher than the amount of ETH sent");

        string memory _domain = string(abi.encodePacked(domain, tldomain));

        string memory combinedSvg = string(abi.encodePacked(pre_svg, _domain, post_svg));

        string memory jsonStringify = Base64.encode(abi.encodePacked('{"name": "',
            _domain, 
            '",',
            '"description": "A domain from Crypto Corgi", "image": "data:image/svg+xml;base64,',
            Base64.encode(bytes(combinedSvg)),
            '"',
             '}'
        ));

        /**
        @dev Create a NFT for the token
        */

        string memory corgiUri = string( abi.encodePacked("data:application/json;base64,", jsonStringify));

        _tokenIds.increment();
        uint tokenId = _tokenIds.current();
        domainCount[domain] = tokenId; 

        _safeMint(msg.sender, tokenId);
        _setTokenURI(tokenId, corgiUri);


        domains[domain] = msg.sender;

    }

    function getOwner(string calldata domain) public view returns(address) {
        return domains[domain];
    }
}